#!nsh

echo "[init] bottle drop test

#
# Load default params for this platform
#
if param compare SYS_AUTOCONFIG 1
then
	# Set all params here, then disable autoconfig
	param set SYS_AUTOCONFIG 0

	param save
fi
 
#
# Force some key parameters to sane values
# MAV_TYPE     2 = quadrotor
#
param set MAV_TYPE 2

set EXIT_ON_END no

#
# Start and configure PX4IO and FMU interface
#
# Start MAVLink (depends on orb)
mavlink start
usleep 5000

#
# Start the sensors and test them.
#
sh /etc/init.d/rc.sensors

#
# Start logging (depends on sensors)
#
#sh /etc/init.d/rc.logging
sdlog2 start -r 200 -e -b 16


#
# Start GPS interface (depends on orb)
#
gps start

#
# Start the attitude estimator
#
attitude_estimator_ekf start
 
#
# Start position estimator
#
position_estimator_inav start

sh /etc/init.d/rc.io

fmu mode_pwm

mixer load /dev/px4fmu /etc/mixers/FMU_pass.mix

pwm min -d /dev/px4fmu -c 123 -p 900
pwm max -d /dev/px4fmu -c 123 -p 2100

pwm arm -d /dev/px4fmu

bottle_drop start


if [ $EXIT_ON_END == yes ]
then
	exit
fi
